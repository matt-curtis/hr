!function(n){var o,e={};e.WEB_SERVER_PORT=9090,e.WEB_SOCKET_PORT=8080,e.NOTIFICATION_BOOKS_DID_UPDATE="BOOKS_DID_UPDATE",e.NOTIFICATION_IMPORT_STATUS_UPDATE="IMPORT_STATUS_UPDATE";var t=new function(){var n=this,t=function(n){var o=[];for(var e in n)o.push(e+"="+escape(n[e]));return o.join("&")},r=function(){var n="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var o=16*Math.random()|0,e="x"==n?o:3&o|8;return e.toString(16)});return n.toUpperCase()},i=function(n){var o=new FormData;for(var e in n)o.append(e,n[e]);return o};n.getURLForEndPoint=function(n,r){var i="http://"+o+":"+e.WEB_SERVER_PORT+n;return r&&(i+="?"+t(r)),i},n.makeRequest=function(o,e,t,s,u){var c={};t||(t={}),t._ran=r();var a=new XMLHttpRequest,f=n.getURLForEndPoint(e,t);a.responseType=u||"json",a.open(o,f),a.onload=function(n){var o=a.response;c.onSuccess&&c.onSuccess(n,o)},a.onprogress=function(n){n.lengthComputable&&c.onProgress&&c.onProgress(n,percent,n.loaded,n.total)},a.error=function(n){c.onFailure&&c.onFailure(n)};var l;return s&&(l=i(s)),a.send(l),c}};e.RestAPI=t;var r=new function(){var n,t=this,r={};this.open=function(i,s){n&&n.close(),n=null;var u=!1,c="ws://"+o+":"+e.WEB_SOCKET_PORT;i&&(c+="?clientName="+i),console.log("Attempting to connect to socket with URL:",c);try{n=new WebSocket(c)}catch(a){console.log("Error thrown while opening socket:",a),s&&s(!1)}n&&(n.onmessage=function(n){var o=JSON.parse(n.data);for(var e in r)if(e==o.type||"*"==e){var t=r[e];if(t)for(var i=0,s=t.length;s>i;i++){var u=t[i];u(o)}}},n.onopen=function(n){u=!0,console.log(n),s&&s(!0)},n.onclose=function(n){console.log(n),s&&!u&&s(!1),t.onClose&&t.onClose()},n.onerror=function(n){console.log(n),t.onError&&t.onError()})},this.send=function(o){n.send(JSON.stringify(o))},this.close=function(){n.close()},this.addNotificationListener=function(n,o,e){r[n]||(r[n]=[]);var t=function(n){o(n),e&&i()},i=function(){for(var o=r[n],e=0,i=o.length;i>e;e++)if(o[e]===t){o.splice(e,1);break}};return r[n].push(t),{remove:i}},Object.defineProperty(this,"socket",{get:function(){return n},enumerable:!0}),Object.defineProperty(this,"isConnecting",{get:function(){return n&&0==n.readyState},enumerable:!0}),Object.defineProperty(this,"isLive",{get:function(){return n&&1==n.readyState},enumerable:!0})};e.Socket=r,e.connect=function(n,e,t){o=n,r.open(e,t)},e.disconnect=function(){r.close()},Object.defineProperty(e,"isConnected",{get:function(){return r.isLive},enumerable:!0});var i=new function(){var n="bookId",o="bookIds";this.getBooks=function(n,e){1==arguments.length&&(e=n,n=null);var r={};n&&n.length>0&&(r[o]=n.join(",")),t.makeRequest("GET","/books",r).onSuccess=function(n,o){e&&e(o)}},this.getURLForBookCover=function(o){var e={};return e[n]=o,t.getURLForEndPoint("/book/cover",e)},this.getURLForBookThumb=function(o){var e={};return e[n]=o,t.getURLForEndPoint("/book/thumb",e)},this.getURLForBookEpub=function(o){var e={};return e[n]=o,t.getURLForEndPoint("/book/epub",e)},this.updateBooks=function(n,e,r){var i=e;n&&n.length>0&&(i[o]=n.join(",")),t.makeRequest("POST","/books/update",null,i).onSuccess=function(n,o){r&&r(o)}},this.updateCoversOfBooks=function(n,e,r){var i={cover:e};i[o]=n.join(","),t.makeRequest("POST","/books/update_cover",null,i).onSuccess=function(n,o){r&&r(o)}},this.importEpubs=function(n,o){for(var e=(n.length,0),r=n.length;r>e;e++){var i={epub:n[e]};t.makeRequest("POST","/books/import",null,i).onSuccess=function(n,e){o(e)}}},this.deleteBooks=function(n,e){var r={};r[o]=n.join(","),t.makeRequest("POST","/books/delete",null,r).onSuccess=function(n,o){e&&e(o)}}};e.Books=i,n.HyphenLink=e}(window);